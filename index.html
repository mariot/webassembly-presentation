<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Empowering JavaScript apps with WebAssembly</title>

		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/moztechspeakers.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/monokai.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section id="main" data-background="#654ff0">
					<h2>Empowering JavaScript apps</h2>
					<h1>with WebAssembly</h1>
					<h3 class="left">Mariot Tsitoara @ Manchester Web Meetup | October | 2019</h3>
				</section>

				<section id="speaker" data-background="#654ff0">
					<section>
						<div class="half left">
							<h2>Hi! I'm Mariot</h2>
							<p>
								Mozilla TechSpeaker.<br>
								Python and JS Developer<br>
								Author of Beginning Git and GitHub (Apress, 2020).<br>
								Savior of Hyrule
							</p>
							<p>
								<img src="img/me/communities.png"  alt="My Communities" />
							</p>
						</div><!--
						--><div class="half left">
							<img src="img/me/Tsitoara_AUphoto.jpg" class="avatar left" alt="Mariot Tsitoara" />
						</div>
					</section>
					<section data-background="img/me/madagascar.png">
						<div class="fragment dark-bg third">
							<img src="img/me/Civilization-VI.jpg" alt="Civilization VI">
							<h3>Civilization VI</h3>
						</div>
						<div class="fragment dark-bg third">
							<img src="img/me/football.jpg" alt="Football Manager">
							<h3>Football Manager</h3>
						</div>
					</section>
				</section>

				<section id="lets-start" data-background="#654ff0">
					<h1>Let's start!</h1>
				</section>

				<section id="wasm">
					<section id="wasm-description" data-background="img/WASM-logo.png">
						<aside class="notes">
							It's a way to execute other langugaes in your website.
							If you want to alter your website, do some calculation or any programming you could only do it with JS. Now you can use other languages

							Binary format, compact, fast load, portable because it can run on any browser, secure.
							Does not replace JS
							Build high performance web applications
							Rounds around 1.2 to 1.5 times than a native speed
						</aside>
					</section>

					<section id="wasm-is">
						<h2>WebAssembly is</h2>
						<div class="third center left">
							<img src="img/js-wasm.jpg" alt="JS and WASM" class="noborder">
						</div><!--
						--><div class="twothirds left">
							<ul>
								<li>Binary format</li>
								<li class="fragment">A compilation target for other languages to compile to</li>
								<li class="fragment">A powerup for JS applications</li>
								<li class="fragment">Interface from/to JS</li>
							</ul>
						</div>
					</section>

					<section id="wasm-is-not">
						<h2>WebAssembly is not</h2>
						<div class="third center left">
							<img src="img/js-wasm.jpg" alt="JS and WASM" class="noborder">
						</div><!--
						--><div class="twothirds left">
							<ul>
								<li>A programming language</li>
								<li class="fragment">A replacement to JavaScript</li>
							</ul>
						</div>
					</section>
				</section>

				<section id="why" data-background="#654ff0">
					<h1>Why do we need this?</h1>
				</section>

				<section id="history">
					<section id="how-web-worked" data-background="img/90s.jpg">
						<aside class="notes">
							The web was in infancy back then. It was simple: everything was on a remote server, and every time your wanted something new, you had to ask for it.

							But even then, people wanted to write applications for the web. Then knew it was the future and wanted to be part of the community that would sharpen it.

							When talking about WebAssembly, you might have a sense of déjà-vu. Compiling other languages for the Web, haven't we tried that before?
						</aside>
					</section>
					<section id="java-applers">
						<h2>Java Applets</h2>
						<div class="half left">
							<img src="img/Java_applet.png" class="noborder">
							<p class="center">
								<strong>Mathematical application</strong>
							</p>
						</div><!--
						--><div class="half">
							<img src="img/NASA_World_Wind.jpg" class="noborder">
							<p class="center">
								<strong>NASA World Wind</strong>
							</p>
						</div>
						<aside class="notes">
							Yes we did. And it was AWEFUL. It was bad. Very bad!
						</aside>
					</section>
					<section id="why-did-applets-disappear">
						<h2>Why did Java Applets disappear?</h2>
						<ul>
							<li>Need to install Java on your computer.</li>
							<li>Zero integration with the web.</li>
							<li>Lost strength due to Flash, Silverlight, HTML5</li>
							<li>Problems with mobile devices</li>
							<li>Lots of Security issues</li>
						</ul>
						<aside class="notes">
							Java was not present in Windows by default, or other devices.
							It was not possible to interact with the rest of the site.
							Flash, Silverlight and HTML5 began to emerge.
							It was not optimal for mobile devices.
							Absent in some architectures such as Linux 64bits.
						</aside>
					</section>
					<section id="java-death" data-background="#654ff0">
						<img src="img/java-applets.png" alt="Logo de Java Applets">
						<h1>....and thus, Java applets began to disappear...</h1>
						<aside class="notes">
							The dream of the language for the web then took a heavy hit.
						</aside>
					</section>
					<section id="javascript-rises" data-background="#f7df1d">
						<p>....until JavaScript</p>
						<aside class="notes">
							It became the language used for the web due to being optimized for mobile devices, did not require installing additional things, present in all architectures.

							Since you are all web developers, I don't need to present this to you. It became the brick and mortar of the web. Everyone and their moms could now develop for the web.

							And a big plus for JavaScript was the arrival of AJAX. It was revolutionnary. Not need to reload anymore, you can browse in peace and the heavy lifting would be done by other applications, stored in a server far away.
						</aside>
					</section>
				</section>
				<section id="javascript">
					<section id="love-js">
						<img src="img/LoveJS.jpg" alt="We love JS" class="noborder">
						<p class="fragment">
							But it has its problems...
						</p>
						<aside class="notes">
							We all love JavaScript. Very much. It has given us so much. Especially the convenient frameworks that seems to appear every two days.
						</aside>
					</section>
					<section id="performance" data-background="img/gifs/slow-turtle.gif">
						<h2 class="white" style="margin-bottom: 40%">Performance</h2>
						<aside class="notes">
							Javascript was never designed to be fast and browsers
							vendors have made an excelent work by improving
							JS speed over the years, but that's not the correct way
							to go.

							We forced JavaScript to do our bidding all those years because we only had her.
							We had no choice.
						</aside>
					</section>
					<section id="why-slow"  data-background="#654ff0">
						<h1>How browsers run JS code</h1>
						<img src="img/js-parsing.png" alt="JS execution">
						<p>
							<small>
								Source: <a href="https://www.youtube.com/watch?v=HktWin_LPf4">Lin Clark</a> &copy; 2017.
							</small>
						</p>
						<aside class="notes">
							This lack of performance is due to how JavaScript code is managed by the browsers.

							There are certain parts of the code that can be optimized before being executed.

							For example, a piece of code inside a loop will be compiled and optimized by the engines.

							But it's not enough.
						</aside>
					</section>
					<section id="slow-example"  data-background="#654ff0">
						<h1>Let's see an <br> execution example...</h1>
					</section>
					
					<section id="js-addition-example">
						<h1>An addition in JS</h1>
						<pre><code>
	function sum(a, b) {
		return a + b;
	}
						</code></pre>
						<p>Pretty simple, right? <br>It <em>"should be a single"</em> CPU instruction</p>
						<aside class="notes">
							How can we know id they are 2 numbers, if I want to concatenate 2 strings, if b value is a number 
							and want to merge it to the left string value. Something simple like this is
							because JS is not typed.
						</aside>
					</section>
	
					<section id="ecma-addition">
						<h2>How ECMA-262 <br> defines an addition</h2>
						<blockquote>
							
						<ol class="small">
							<li>Let lref be the result of evaluating AdditiveExpression.</li>
							<li>Let lval be GetValue(lref).</li>
							<li>Let rref be the result of evaluating MultiplicativeExpression.</li>
							<li>Let rval be GetValue(rref).</li>
							<li>Let lprim be ToPrimitive(lval).</li>
							<li>Let rprim be ToPrimitive(rval).</li>
							<li>
									If Type(lprim) is String or Type(rprim) is String, then
									<ul>
										<li>
										Return the String that is the result of concatenating ToString(lprim) followed by ToString(rprim)
										</li>
										<li>
										Return the result of applying the addition operation to ToNumber(lprim) and ToNumber(rprim).
										</li>
									</ul>
							</li>
						</ol>
						</blockquote>
						<p class="small right">
							Source: 
							<a href="https://www.ecma-international.org/ecma-262/5.1/" title="ECMAScript Spec">ECMAScript® Language Specification. (Sec. 11.6.1)</a>
						</p>
						<aside class="notes">
							If this code is inside a loop, it will be around 8 times slower
							than native code.
						</aside>
					</section>
	
					<section id="why-slow-2">
						<h2>Why?</h2>
						<p>
							You have to do some sacrifices
						</p>
						<div class="half left">
							<img src="img/programmers.jpg" alt="Programmers">
							<p class="small center">Understand Programming languages</p>
						</div><!--
						--><div class="half left">
							<img src="img/devices.jpg" alt="Dispositivos">
							<p class="small center">Understand binary or low level code.</p>
						</div>
						<aside class="notes">
							To make a language comfortable for people, you have to 
							sacrifice performance, because it's better to make application that's easy to create
							you don't need to execute it at maximum performance all the time.
						</aside>
					</section>
				</section>
				<section id="how-solve" data-background="#654ff0">
					<h1>How to solve this?</h1>
				</section>
				<section id="webassembly">
					<section id="wasm-js">
						<h2>WebAssembly</h2>
						<div class="third center left">
							<img src="img/js-wasm.jpg" alt="JS and WASM" class="noborder">
						</div>
					</section>
					<section id="wasm-runs"  data-background="#654ff0">
						<h1>How browsers run WASM</h1>
						<img src="img/wasm-execute.png" alt="WASM execution" class="half">
						<p>
							<small>
								Source: <a href="https://www.youtube.com/watch?v=HktWin_LPf4">Lin Clark</a> &copy; 2017.
							</small>
						</p>
						<aside class="notes">
							As we see here, there are less stages to pass through before execution.

							And those stages are shorter.

							It's faster
						</aside>
					</section>
					<section id="wasm-binary">
						<h2>Binary format</h2>
						<p>
							<img src="img/wasm7codeexplorer.png" alt="WASM binary explorer" class="center twothirds">
						</p>
						<p>
							Check it with
							<a href="https://wasdk.github.io/wasmcodeexplorer/" title="Check tool">
								WASM Code Explorer
							</a>
						</p>
						<aside class="notes">
							First 4 bytes is a number that represents .asm, then version, functions, memory, etc.
						</aside>
					</section>
					<section id="wast">
						<h2>WebAssembly Text Format</h2>
<pre><code>(module
	(type $type0 (func (param i32)))
	(type $type1 (func))
	(import "sys" "print" (func $import0 (param i32)))
	(memory (;0;) 200 200)
	(export "memory" (memory 0))
	(export "main" (func $func1))
	(func $func1
	i32.const 0
	call $import0
	)
	(data (i32.const 0)
	"Hello, world\00"
	)
)</code></pre>
						<p>
							Hello World in WAT
						</p>
						<aside class="notes">
							It's used for human notation, some security firms work at this level, is platform independent.
							Check types, parameters
						</aside>
					</section>
					<section id="fashion" data-background="#654ff0">
						<h1>You might think it's just trendy....</h1>
					</section>
					<section id="browsers" data-background="#654ff0">
						<h1>No! <br> it has great support!</h1>
						<div class="fragment">
							<img src="img/browser-logos.png" alt="web browsers" class="noborder padding" />
						</div>
						<aside class="notes">
								I think it's the first time we've seen a technology initially supported by all browsers.
								
								First proposed by Firefox, then Edge, Google Chrome and finally Safari.
								
								Interoperability is guaranteed.

								Approximately 65% of the market can run WASM.
						</aside>
					</section>
				</section>
				<section id="how-created"  data-background="#654ff0">
					<h1>How it's created?</h1>
				</section>
				<section id="create-wasm">
					<section id="compiler-target">
						<h2>Compiler target</h2>
						<p>
							Each supported language's compiler
							will generate a <strong>.wasm</strong> file from the compiler.
						</p>
	
						<div class="left">
							<h4>Rust</h4>
							<pre style="width: 100%"><code>rustc --target=wasm32-unknown-uknown project.rs -o project.html</code></pre>
							<h4>GO</h4>
							<pre style="width: 100%"><code>GOOS=js GOARCH=wasm go build -o main.wasm</code></pre>
						</div>
					</section>
					<section id="emscripten">
						<h2>Emscripten</h2>
						<p>
							It's a toolchain to take high languages code to WASM
						</p>
						<div class="compile-process">
							<span class="c">C/C++</span> &rarr;
							<span class="llvm">LLVM</span> &rarr;
							<span class="emscripten">Emscripten</span> + <span class="asm">Binaryen</span> &rarr;
							<span class="wasm">WASM</span>
						</div>
						<p class="left">Execute</p>
						<pre><code>emcc project.c -s WASM=1 -o project.html</code></pre>
						<aside class="notes">
								Like nobody writes in ASM (although it is possible), it uses high level language and compiles to generate the binary file.
								The same is with WASM. It is encoded in C / C ++ and RUST, using this set of tools the WASM file is obtained.
						</aside>
					</section>
	
					<section id="compilation-result" data-background="#654ff0">
						<h1>What do I get with this?</h1>
					</section>
	
					<section id="results">
						<h2>Compilation result</h2>
						<p class="left">
							You'll get at least these 3 files:
						</p>
						<ol>
							<li>The <strong>.wasm</strong> file.</li>
							<li>JS code to import WASM module.</li>
							<li>HTML page to execute the WASM module.</li>
						</ol>
					</section>
	
					<section id="code-interaction">
						<h2>Code interaction</h2>
							<img src="img/wasm-c.png" class="half noborder" alt="JS and C interaction">
						<p>
							<small>Comunicate code between JS and WASM</small>
						</p>
					</section>
	
	
					<section id="interacion-js-wasm">
						<h2>Calls C functions from JS</h2>
						<p>C</p>
						<pre><code>#include &lt;math.h&gt;
extern "C" {
	int int_sqrt(int x) {
		return sqrt(x);
	}
}</code></pre>
	
						<p>JavaScript</p>
						<pre><code>int_sqrt = Module.cwrap('int_sqrt', 'number', ['number'])
int_sqrt(12)
int_sqrt(28)</code></pre>
					<aside class="notes">
						ccall() calls a function and cwrap() grabs it.
						Second parameter is the return and last is the type of the parameters:
						number, string or array.
					</aside>
				</section>

				<section id="interacion-c-js">
					<h2>Call JS functions from C</h2>
					<div class="half left">
						<p class="small">With <em>emscripten_run_script()</em></p>

						<pre><code>emscripten_run_script(
	"alert('I love alerts')"
);</code></pre>
						</div><!--
						--><div class="half left">
							<p class="small">With <em>EM_ASM()</em></p>
							<pre><code>#include &lt;emscripten.h&gt;
int main() {
	EM_ASM(
	alert('DO NOT USE ALERTS!');
	throw 'execution ready';
	);
	return 0;
}}</code></pre>
						</div>
						<aside class="notes">
							Remember to include emscripten, that's the only way. And alert is not used in node.
						</aside>
					</section>
				</section>
				<section id="use-example" data-background="#654ff0">
					<h1>What can I do with WASM?</h1>
				</section>
				<section id="examples">
					<section id="zen-garden" data-background-video="img/video/zengarden.mp4">
						<aside class="notes">
								Library optimization.
								Video codecs
								Programs to encrypt faster.
								Video game.
								Image treatment
							</li>
						</aside>
					</section>
					<section id="wasm-video-editor">
						<h2>WASM video editor</h2>
						<a href="https://d2jta7o2zej4pf.cloudfront.net/">
							<img src="img/wasm-editor.jpg" alt="WASM Video Editor" class="noborder">
						</a>
						<p>Applies video effects on realtime</p>
					</section>
	
					<section id="aprende-c">
						<h2>Aprende C (Learn C)</h2>
						<img src="img/AprendeC.png" alt="Learn C with WASM" class="half noborder"> 
						<p>
							A website to learn C; <br> code is executed at browser level
						</p>
					</section>
	
					<section id="autocad-on-the-web">
						<h2>AutoCAD on the web</h2>
						<img src="img/autocad-web.png" alt="AutoCAD web" class="half"> 
						<p>
							Source: <a href="https://twitter.com/AutoCAD/status/993963826914648064">Twitter</a>.
						</p>
					</section>
	
					<section id="wp-gutenberg">
						<h2>WordPress Gutenberg Parser</h2>
						<img src="img/wp-gutenberg.png" alt="WordPress Gutenberg" class="half"> 
						<p>
							WordPress' new editor uses a parser written in Rust.
						</p>
					</section>
	
					<section id="wp-gutenberg-results" data-background="img/wasm-parser-results.png">
					</section>
	
					<section id="pib">
						<h2>PIB: PHP In the Browser</h2>
						<p>Zend interpreter migrated to WASM</p>
						<img src="img/pib.png" alt="PIB: PHP in the browser" class="half"> 
						<p>
							More info at: 
							<a href="https://github.com/oraoto/pib" alt="Visit site">https://github.com/oraoto/pib</a>
						</p>
					</section>
	
					<section id="full-php-stack" data-background="#654ff0">
						<h1>We can go <br> full-stack with PHP!</h1>
						<h2 class="fragment">Bye Bye JS! (Just kidding)</h2>
					</section>
				</section>
				<section id="future">
					<h2>Future WASM features</h2>
					<ul>
						<li>Multi-threading and Atomics</li>
						<li>Exception handling</li>
						<li>Garbage collection</li>
						<li>Global mutable variables</li>
						<li>SIMD.</li>
						<li>JS BigInt &larr;&rarr; WebAssembly i64.</li>
					</ul>
					<p>
						<small>
							More at:
							<a href="https://webassembly.org/docs/future-features/" target="_blank">
								https://webassembly.org/docs/future-features/
							</a>
						</small>
					</p>
					<aside class="notes">
						Atomics is that you'll see full value before or after change, not in the middle.
						Initial Threads will be with be Service Workers and then with OS threads.
					</aside>
				</section>

				<section id="available">
					<div class="dark-bg white">
						<h2>Don't wait!</h2>
						<h1>Test it now with 
							<a href="https://webassembly.studio/" title="WASM Studio" title="WASM Studio">
								WebAssembly Studio!
							</a>
						</h3>
					</div>
				</section>

				<section id="links">
					<h2 class="title">Recommended Links</h2>
					<ul>
						<li><a href="https://webassembly.org/">WASM official site</a></li>
						<li><a href="https://webassembly.studio/">WebAssembly Studio</a></li>
						<li><a href="https://developer.mozilla.org/en-US/docs/WebAssembly">Web Docs information</a></li>
						<li><a href="https://blog.mikaellundin.name/2016/06/19/creating-a-webassembly-binary-and-running-it-in-a-browser.html/">WASM Binary Structure</a></li>
						<li><a href="https://hacks.mozilla.org/?s=webassembly">Mozilla Hacks</a></li>
						<li><a href="https://kripken.github.io/emscripten-site/">emscripten website</a></li>
					</ul>
				</section>
				<section id="social" data-background="#654ff0">
					<img src="img/gifs/thank-you.gif">
					<div>
						mariot.tsitoara<strong>@pm.me</strong><br>
						<a class="white" href="https://mariot.hianatra.com" alt="Personal site">mariot.hianatra.com</a><br>
						<div class="social">
							<a href="https://twitter.com/mariot_tsitoara">@mariot_tsitoara</a>  |
							<a href="https://twitter.com/mozhacks">@mozhacks</a>
						</small>
					</div>
				</section>
			</div>
		</div>

		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true }
				]
			});
		</script>
	</body>
</html>
